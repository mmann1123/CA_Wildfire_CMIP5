---
title: "CA_WILDFIRE_PLOTS"
author: "Michael Mann"
date: "January 31, 2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
rm(list=ls())

knitr::opts_chunk$set(echo = TRUE)
library(raster)
library(sf)
library(ggplot2)
library(rasterVis)
library(tools)
```
 
 # Read MFRI 
 
```{r Read in MFRIs, include=T}
 all_mfri = list.files('./Wildfire_MFRI/',pattern = '.tif',full.names = T)
 for(file in all_mfri){
   object_name = file_path_sans_ext(basename(file))
   assign(object_name, raster(file))
 }

```

 # Get stats for 01-25 & 26-50  MFRIs  cap at 500 years 
 
```{r Read in MFRIs , include=T}
 all_2001_2025 = stack(all_mfri[grepl('2001_2025',all_mfri)])
 all_2026_2050 = stack(all_mfri[grepl('2026_2050',all_mfri)])
 capat=500
 summary_functions = c('min','max','mean' )
 for(summary in summary_functions){
   for(stac in c('all_2001_2025','all_2026_2050')){
      assign(paste(summary,stac,sep='_'),do.call(summary,list(x=get(stac),na.rm=T)))
      capper = get(paste(summary,stac,sep='_'))
      # write out df for ggplot
      capper.df = data.frame(rasterToPoints(capper))
      names(capper.df)  =c("lon", "lat","MFRI")
      assign(paste(summary,stac,'df',sep='_') ,capper.df)
      # cap at catat yrs
      capper[capper>capat]=capat 
      assign(paste(summary,stac,'capped',sep='_'),capper)
   }}
 
  # write out df for ggplot
  MFRI_76_00.df = data.frame(rasterToPoints(MFRI_76_00))
  names(MFRI_76_00.df)  =c("lon", "lat","MFRI")

```


```{r Plot Change in MFRIs 2000 - 2025 mean, include=T}
 mean_chg_76_25 = MFRI_76_00.df
 mean_chg_76_25$MFRI =  mean_all_2001_2025_df$MFRI-mean_chg_76_25$MFRI
 mean_chg_76_25$MFRI[ mean_chg_76_25$MFRI >350]=350
 rng= range(mean_chg_76_25$MFRI)
 
 ggplot()+geom_raster(data=mean_chg_76_25,aes(x=lon,y=lat,fill=MFRI))+ 
   scale_fill_gradientn(colours= c("#cc0000", "#cc0000"  , 'grey', "#339933","#339933" ), #colors in 
      limits=c(-350, 350))+ #same limits for plots
   ggtitle('Change in MFRIs 2000 - 2025 mean model run')
``` 
 
```{r Plot Change in MFRIs 2000 - 2050 mean, include=T}
 mean_chg_76_50 = MFRI_76_00.df
 mean_chg_76_50$MFRI =  mean_all_2026_2050_df$MFRI-mean_chg_76_50$MFRI
 mean_chg_76_50$MFRI[ mean_chg_76_50$MFRI >350]=350
 rng= range(mean_chg_76_50$MFRI)
 
 ggplot()+geom_raster(data=mean_chg_76_50,aes(x=lon,y=lat,fill=MFRI))+ 
   scale_fill_gradientn(colours= c("#cc0000", "#cc0000"  , 'grey', "#339933","#339933" ), #colors in 
                 limits=c(-350, 350))+ #same limits for plots
    ggtitle('Change in MFRIs 2000 - 2050 mean model run')
``` 
 
 
```{r Plot MFRIs, eval=FALSE, include=FALSE}
 all_2001_2025 = stack(all_mfri[grepl('2001_2025',all_mfri)])
 all_2026_2050 = stack(all_mfri[grepl('2026_2050',all_mfri)])
 capat=1e14
 summary_functions = c('min','max','mean' )
 for(summary in summary_functions){
   for(stac in c('all_2001_2025','all_2026_2050')){
      assign(paste(summary,stac,sep='_'),do.call(summary,list(x=get(stac),na.rm=T)))
      capper = get(paste(summary,stac,sep='_'))
      capper[capper>capat]=capat # cap at 500 yrs
      assign(paste(summary,stac,sep='_'),capper)
   }}
 
 
  plot(min_all_2026_2050)
  MFRI_76_00[MFRI_76_00>500]=500
  plot(MFRI_76_00)
```



